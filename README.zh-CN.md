# 使用 Agent 模拟囚徒困境

## 项目概览
这是一个基于 **AutoGen** 框架的游戏理论模拟项目，旨在通过 **大语言模型（LLM）驱动的 Agent** 来探索经典的**囚徒困境**博弈。

通过完整模拟这个博弈，可以深入研究 LLM Agent 在不同情景下的决策行为。本项目设计了高度灵活的配置，让你能够轻松调整各种实验参数，包括：

- **收益矩阵(Payoff Matrix)**: 设定博弈的奖励和惩罚。
- **Agent 行为**: 定义 Agent 的角色、身份和决策风格。
- **模拟步骤**: 精细控制实验的每一步。

每次实验的结果都会被记录，以可以进一步相关分析。


## 核心组件
项目结构清晰，核心代码位于 `game` 目录。
- **`agents`**: 定义了两种核心 Agent：
  - **`Participant`** (参与者): 扮演囚徒的角色，其行为和决策是实验的重点。
  - **`Manager`** (管理者): 负责协调和运行整个实验，并记录结果。
- **`configs`**: 集中管理所有实验配置。我使用 Python 对象和 `TypeDict` 声明了配置字段，方便你直接修改。此外，提示模板 (Prompt Template) 支持动态生成，你可以通过修改 `kwargs` 来定制化提示，从而控制 Agent 的行为。
- **`prompts`**: 包含了所有与提示相关的文件。虽然有很多模板，但核心逻辑集中在 `participant_prompts.py` 中，它封装了复杂的字符串处理，让提示的修改变得简单高效。
- **`protocols`**: 定义了 Agent 之间的通信协议。我们使用 `dataclass` 来定义，结构简单，易于理解和修改。
- **`runtime`**: 封装了 AutoGen 的运行时对象，提供了一个简单易用的运行器。
- **`utils`**: 包含一些辅助工具函数，例如处理 f-string 和转换 JSON 数据。


## 如何运行
只需两步，即可开始你的实验：
### 1. 配置实验
在 `configs` 目录中，你可以根据需要调整以下文件: 
- **`_model_client.py`**: 配置你的模型客户端。默认支持**通义千问（Qwen）**，你也可以自定义添加工厂方法来使用其他OpenAI客户端兼容的模型。
- **`game_request.py`**: 调整游戏设置，如实验的回合数，以及批量修改提示模板。
- **`manager_config.py`**: 设定游戏规则、参与者数量和结果存储路径。
- **`participant_config.py`**: 更改每个参与者使用的底层 LLM 模型、他们的身份设定以及推理方式。

所有配置都有默认值，你也可以直接运行而无需任何修改。

### 2. 运行代码
在命令行中运行 `run_a_game.py`。你将实时看到实验过程的输出。实验结果将自动保存到你在配置中指定的目录。


## 有趣的发现
在模拟囚徒困境的过程中，我观察到 LLM Agent 展现出许多**类似人类的行为**。只要给出清晰的指令，它们就会表现出复杂而多样的决策模式。

- **策略演变**: 在多轮实验中，Agent 会根据对方的行为调整自己的策略。
- **行为经济学**: 它们会表现出多种复杂的行为，例如在不同情境下选择合作或背叛，这与行为经济学中的某些策略不谋而合。
- **合作倾向**: 大部分 Agent 更倾向于**合作**。这可能是因为训练 LLM 的数据使其倾向于友好和协作。然而，更“聪明”或“有创造力”的 Agent 则更可能选择**不合作**，以追求自身利益最大化。

这些发现表明，LLM Agent 的行为并非完全理性，它们在许多方面都与人类决策相似，为我们研究 LLM 的社会行为提供了新的视角。


## 未来展望
该项目还存在一些改进空间，欢迎你贡献代码！
- **通信方式**: 目前采用的是直接调用方式，未来可以探索更高效的广播通信机制。
- **配置优化**: 进一步简化配置流程，降低使用门槛。
- **日志系统**: 探索更健壮、更灵活的日志记录方案，例如使用 AutoGen 内置的 `ClosureAgent` 或其他更优的实现。

如果你对这个项目有任何想法或建议，请随时提交 Issue 或 Pull Request。


## 其他项目
如果你对博弈论或者 LLM-based Agent 感兴趣，可以查看我的其他项目:
- [Agent-Development-Toolkit](https://github.com/yuliu625/Yu-Agent-Development-Toolkit): 我构建的通用 Agent 开发相关工具。
- [World-of-Six](https://github.com/yuliu625/World-of-Six): 一种复杂博弈论场景下 LLM-based Agent 行为的研究。这是我一篇被 **SWAIB[2025]** 接收的会议论文对应的仓库。
- **暂未开源**: 我目前有一篇关于 LLM-based Agent 在具有网络效应的环境下的预期行为的研究，是工作论文。这篇期刊投中之后，对应的代码仓库也会开源。

